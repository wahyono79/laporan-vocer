<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Penjualan Voucher WiFi</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --accent: #e74c3c;
            --light: #ecf0f1;
            --success: #27ae60;
            --warning: #f39c12;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .navbar {
            background-color: var(--primary);
        }
        
        .navbar-brand {
            font-weight: 700;
        }
        
        .card {
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            border: none;
        }
        
        .card-header {
            background-color: var(--secondary);
            color: white;
            border-radius: 10px 10px 0 0 !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--secondary);
            border-color: var(--secondary);
        }
        
        .btn-primary:hover {
            background-color: #2980b9;
            border-color: #2980b9;
        }
        
        .btn-success {
            background-color: var(--success);
            border-color: var(--success);
        }
        
        .btn-danger {
            background-color: var(--accent);
            border-color: var(--accent);
        }
        
        .summary-card {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            color: white;
            margin-bottom: 20px;
        }
        
        .summary-card.sales {
            background: linear-gradient(135deg, #3498db, #2c3e50);
        }
        
        .summary-card.fee {
            background: linear-gradient(135deg, #f39c12, #e74c3c);
        }
        
        .summary-card.net {
            background: linear-gradient(135deg, #27ae60, #2ecc71);
        }
        
        .summary-card h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .summary-card h2 {
            font-size: 24px;
            font-weight: 700;
        }
        
        .notification-toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .form-control:focus {
            border-color: var(--secondary);
            box-shadow: 0 0 0 0.25rem rgba(52, 152, 219, 0.25);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(52, 152, 219, 0.1);
        }
        
        .action-buttons .btn {
            margin-right: 5px;
        }
        
        @media (max-width: 768px) {
            .summary-card {
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
        <div class="container">
            <a class="navbar-brand" href="#">
                <i class="fa-solid fa-wifi me-2"></i>Manajemen Voucher WiFi
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#" id="nav-input">
                            <i class="fa-solid fa-plus-circle me-1"></i> Input Penjualan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="nav-data">
                            <i class="fa-solid fa-table me-1"></i> Data Penjualan
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" id="nav-report">
                            <i class="fa-solid fa-chart-bar me-1"></i> Laporan
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Input Section -->
        <div class="card mb-4" id="input-section">
            <div class="card-header">
                <i class="fa-solid fa-plus-circle me-2"></i>Input Data Penjualan
            </div>
            <div class="card-body">
                <form id="sales-form">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="tanggal" class="form-label">Tanggal</label>
                            <input type="date" class="form-control" id="tanggal" required>
                        </div>
                        <div class="col-md-6">
                            <label for="nama" class="form-label">Nama Pelanggan</label>
                            <input type="text" class="form-control" id="nama" placeholder="Nama pelanggan" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label for="paket" class="form-label">Paket</label>
                            <select class="form-select" id="paket" required>
                                <option value="">Pilih Paket</option>
                                <option value="24 Jam">24 Jam</option>
                                <option value="7 Hari">7 Hari</option>
                                <option value="15 Hari">15 Hari</option>
                                <option value="30 Hari">30 Hari</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label for="harga" class="form-label">Harga (Rp)</label>
                            <input type="number" class="form-control" id="harga" readonly>
                        </div>
                        <div class="col-md-4">
                            <label for="kode" class="form-label">Kode Voucher</label>
                            <input type="text" class="form-control" id="kode" placeholder="Kode voucher" required>
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fee" class="form-label">Fee Penjual (Rp)</label>
                            <input type="number" class="form-control" id="fee" readonly>
                        </div>
                        <div class="col-md-6">
                            <label for="setoran" class="form-label">Setoran Bersih (Rp)</label>
                            <input type="number" class="form-control" id="setoran" readonly>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary">
                        <i class="fa-solid fa-save me-2"></i>Simpan Data
                    </button>
                </form>
            </div>
        </div>

        <!-- Data Section -->
        <div class="card mb-4 d-none" id="data-section">
            <div class="card-header">
                <i class="fa-solid fa-table me-2"></i>Data Penjualan
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Nama Pelanggan</th>
                                <th>Paket</th>
                                <th>Harga</th>
                                <th>Kode Voucher</th>
                                <th>Fee Penjual</th>
                                <th>Setoran Bersih</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="sales-data">
                            <!-- Data akan diisi oleh JavaScript -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Report Section -->
        <div class="card mb-4 d-none" id="report-section">
            <div class="card-header">
                <i class="fa-solid fa-chart-bar me-2"></i>Laporan Penjualan
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="summary-card sales">
                            <h3>Total Penjualan</h3>
                            <h2 id="total-penjualan">Rp 0</h2>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="summary-card fee">
                            <h3>Total Fee Penjual</h3>
                            <h2 id="total-fee">Rp 0</h2>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="summary-card net">
                            <h3>Total Setoran Bersih</h3>
                            <h2 id="total-setoran">Rp 0</h2>
                        </div>
                    </div>
                </div>
                
                <div class="d-flex gap-2">
                    <button class="btn btn-success" id="print-pdf">
                        <i class="fa-solid fa-file-pdf me-2"></i>Print PDF
                    </button>
                    <button class="btn btn-danger" id="setor-button">
                        <i class="fa-solid fa-money-bill-transfer me-2"></i>Setor
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Toast -->
    <div class="notification-toast toast align-items-center text-white bg-success border-0 d-none" role="alert" id="success-toast">
        <div class="d-flex">
            <div class="toast-body">
                <i class="fa-solid fa-check-circle me-2"></i>
                <span id="toast-message">Operasi berhasil dilakukan</span>
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Konstanta untuk aturan harga dan fee
        const PAKET_RULES = {
            "24 Jam": { harga: 5000, fee: 1000 },
            "7 Hari": { harga: 20000, fee: 2000 },
            "15 Hari": { harga: 35000, fee: 5000 },
            "30 Hari": { harga: 60000, fee: 5000 }
        };

        // Data storage menggunakan localStorage
        let salesData = JSON.parse(localStorage.getItem('salesData')) || [];
        let historyData = JSON.parse(localStorage.getItem('historyData')) || [];

        // Elemen UI
        const navInput = document.getElementById('nav-input');
        const navData = document.getElementById('nav-data');
        const navReport = document.getElementById('nav-report');
        const inputSection = document.getElementById('input-section');
        const dataSection = document.getElementById('data-section');
        const reportSection = document.getElementById('report-section');
        const salesForm = document.getElementById('sales-form');
        const paketSelect = document.getElementById('paket');
        const hargaInput = document.getElementById('harga');
        const feeInput = document.getElementById('fee');
        const setoranInput = document.getElementById('setoran');
        const salesDataBody = document.getElementById('sales-data');
        const totalPenjualan = document.getElementById('total-penjualan');
        const totalFee = document.getElementById('total-fee');
        const totalSetoran = document.getElementById('total-setoran');
        const printPdfButton = document.getElementById('print-pdf');
        const setorButton = document.getElementById('setor-button');
        const successToast = document.getElementById('success-toast');
        const toastMessage = document.getElementById('toast-message');

        // Inisialisasi halaman
        document.addEventListener('DOMContentLoaded', function() {
            // Set tanggal hari ini sebagai default
            const today = new Date().toISOString().substr(0, 10);
            document.getElementById('tanggal').value = today;
            
            // Render data jika ada
            renderSalesTable();
            updateSummary();
            
            // Setup event listeners
            setupEventListeners();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Navigasi
            navInput.addEventListener('click', () => showSection('input'));
            navData.addEventListener('click', () => showSection('data'));
            navReport.addEventListener('click', () => showSection('report'));
            
            // Perhitungan otomatis saat paket berubah
            paketSelect.addEventListener('change', hitungHarga);
            
            // Form submission
            salesForm.addEventListener('submit', simpanData);
            
            // Tombol aksi
            printPdfButton.addEventListener('click', printPDF);
            setorButton.addEventListener('click', setorDana);
        }

        // Fungsi untuk menampilkan section yang dipilih
        function showSection(section) {
            // Sembunyikan semua section
            inputSection.classList.add('d-none');
            dataSection.classList.add('d-none');
            reportSection.classList.add('d-none');
            
            // Nonaktifkan semua nav link
            navInput.classList.remove('active');
            navData.classList.remove('active');
            navReport.classList.remove('active');
            
            // Tampilkan section yang dipilih dan aktifkan nav link
            if (section === 'input') {
                inputSection.classList.remove('d-none');
                navInput.classList.add('active');
            } else if (section === 'data') {
                dataSection.classList.remove('d-none');
                navData.classList.add('active');
                renderSalesTable();
            } else if (section === 'report') {
                reportSection.classList.remove('d-none');
                navReport.classList.add('active');
                updateSummary();
            }
        }

        // Fungsi untuk menghitung harga, fee, dan setoran berdasarkan paket
        function hitungHarga() {
            const paket = paketSelect.value;
            
            if (paket && PAKET_RULES[paket]) {
                const harga = PAKET_RULES[paket].harga;
                const fee = PAKET_RULES[paket].fee;
                const setoran = harga - fee;
                
                hargaInput.value = harga;
                feeInput.value = fee;
                setoranInput.value = setoran;
            } else {
                hargaInput.value = '';
                feeInput.value = '';
                setoranInput.value = '';
            }
        }

        // Fungsi untuk menyimpan data penjualan
        function simpanData(e) {
            e.preventDefault();
            
            const newSale = {
                id: Date.now(),
                tanggal: document.getElementById('tanggal').value,
                nama: document.getElementById('nama').value,
                paket: paketSelect.value,
                harga: parseInt(hargaInput.value),
                kode: document.getElementById('kode').value,
                fee: parseInt(feeInput.value),
                setoran: parseInt(setoranInput.value)
            };
            
            salesData.push(newSale);
            localStorage.setItem('salesData', JSON.stringify(salesData));
            
            // Tampilkan notifikasi
            showNotification('Data penjualan berhasil disimpan!');
            
            // Reset form
            salesForm.reset();
            document.getElementById('tanggal').value = new Date().toISOString().substr(0, 10);
            hargaInput.value = '';
            feeInput.value = '';
            setoranInput.value = '';
            
            // Kirim notifikasi
            sendNotifications('Data baru ditambahkan', 
                `Data penjualan baru telah ditambahkan:
                - Pelanggan: ${newSale.nama}
                - Paket: ${newSale.paket}
                - Harga: ${newSale.harga}
                - Kode: ${newSale.kode}`);
        }

        // Fungsi untuk merender tabel data penjualan
        function renderSalesTable() {
            salesDataBody.innerHTML = '';
            
            if (salesData.length === 0) {
                salesDataBody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fa-solid fa-inbox fs-1 d-block text-muted mb-2"></i>
                            <span class="text-muted">Tidak ada data penjualan</span>
                        </td>
                    </tr>
                `;
                return;
            }
            
            salesData.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(sale.tanggal)}</td>
                    <td>${sale.nama}</td>
                    <td>${sale.paket}</td>
                    <td>Rp ${sale.harga.toLocaleString('id-ID')}</td>
                    <td>${sale.kode}</td>
                    <td>Rp ${sale.fee.toLocaleString('id-ID')}</td>
                    <td>Rp ${sale.setoran.toLocaleString('id-ID')}</td>
                    <td class="action-buttons">
                        <button class="btn btn-sm btn-warning" onclick="editSale(${sale.id})">
                            <i class="fa-solid fa-edit"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="hapusSale(${sale.id})">
                            <i class="fa-solid fa-trash"></i>
                        </button>
                    </td>
                `;
                salesDataBody.appendChild(row);
            });
        }

        // Fungsi untuk mengedit data penjualan
        function editSale(id) {
            const sale = salesData.find(s => s.id === id);
            if (sale) {
                document.getElementById('tanggal').value = sale.tanggal;
                document.getElementById('nama').value = sale.nama;
                paketSelect.value = sale.paket;
                hargaInput.value = sale.harga;
                document.getElementById('kode').value = sale.kode;
                feeInput.value = sale.fee;
                setoranInput.value = sale.setoran;
                
                // Hapus data lama
                hapusSale(id, false);
                
                // Scroll ke form input
                showSection('input');
                window.scrollTo(0, 0);
                
                showNotification('Data siap untuk diedit');
            }
        }

        // Fungsi untuk menghapus data penjualan
        function hapusSale(id, showNote = true) {
            salesData = salesData.filter(s => s.id !== id);
            localStorage.setItem('salesData', JSON.stringify(salesData));
            
            if (showNote) {
                showNotification('Data berhasil dihapus');
                
                // Kirim notifikasi
                sendNotifications('Data dihapus', 'Data penjualan telah dihapus dari sistem.');
            }
            
            renderSalesTable();
            updateSummary();
        }

        // Fungsi untuk memperbarui ringkasan laporan
        function updateSummary() {
            const totalPenjualanValue = salesData.reduce((sum, sale) => sum + sale.harga, 0);
            const totalFeeValue = salesData.reduce((sum, sale) => sum + sale.fee, 0);
            const totalSetoranValue = salesData.reduce((sum, sale) => sum + sale.setoran, 0);
            
            totalPenjualan.textContent = `Rp ${totalPenjualanValue.toLocaleString('id-ID')}`;
            totalFee.textContent = `Rp ${totalFeeValue.toLocaleString('id-ID')}`;
            totalSetoran.textContent = `Rp ${totalSetoranValue.toLocaleString('id-ID')}`;
        }

        // Fungsi untuk mencetak PDF
        function printPDF() {
            Swal.fire({
                title: 'Print Laporan PDF',
                text: 'Fitur ini akan mengunduh laporan dalam format PDF',
                icon: 'info',
                showCancelButton: true,
                confirmButtonText: 'Print',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Simulasi print PDF
                    showNotification('Mempersiapkan laporan PDF...');
                    
                    setTimeout(() => {
                        showNotification('Laporan PDF berhasil diunduh!');
                    }, 1500);
                }
            });
        }

        // Fungsi untuk setor dana
        function setorDana() {
            if (salesData.length === 0) {
                Swal.fire({
                    title: 'Tidak ada data',
                    text: 'Tidak ada data penjualan untuk disetor',
                    icon: 'warning',
                    confirmButtonText: 'OK'
                });
                return;
            }
            
            Swal.fire({
                title: 'Setor Data',
                text: 'Apakah Anda yakin ingin melakukan setoran? Data akan dipindahkan ke riwayat.',
                icon: 'question',
                showCancelButton: true,
                confirmButtonText: 'Ya, Setor!',
                cancelButtonText: 'Batal'
            }).then((result) => {
                if (result.isConfirmed) {
                    // Pindahkan data ke riwayat
                    historyData = [...historyData, ...salesData];
                    localStorage.setItem('historyData', JSON.stringify(historyData));
                    
                    // Kosongkan data penjualan
                    salesData = [];
                    localStorage.setItem('salesData', JSON.stringify(salesData));
                    
                    // Perbarui tampilan
                    renderSalesTable();
                    updateSummary();
                    
                    showNotification('Setoran berhasil dilakukan! Data telah dipindahkan ke riwayat.');
                    
                    // Kirim notifikasi
                    sendNotifications('Setoran dilakukan', 
                        `Data setoran telah dipindahkan ke riwayat. 
                        Jumlah data yang disetor: ${historyData.length}`);
                }
            });
        }

        // Fungsi untuk menampilkan notifikasi
        function showNotification(message) {
            toastMessage.textContent = message;
            const toast = new bootstrap.Toast(successToast);
            successToast.classList.remove('d-none');
            toast.show();
        }

        // Fungsi untuk mengirim notifikasi
        function sendNotifications(subject, body) {
            // Simulasi pengiriman notifikasi
            console.log('Notifikasi dikirim:');
            console.log('Subject:', subject);
            console.log('Body:', body);
            
            // Dalam implementasi nyata, ini akan mengirim email atau notifikasi
            // ke penjual dan pemilik menggunakan Google Apps Script
        }

        // Fungsi untuk memformat tanggal
        function formatDate(dateString) {
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('id-ID', options);
        }
    </script>
</body>
</html>
